<!DOCTYPE html>
<html>
  <head>
<!-- Basic Page Needs
–––––––––––––––––––––––––––––––––––––––––––––––––– -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>State + Social Map</title>

<!-- CSS
–––––––––––––––––––––––––––––––––––––––––––––––––– -->
<style>

  body {
    background-color: #fff;
    text-align: center;
    padding: 0 10%;
  }

  svg { padding: 0 2em 0 3em; }

  #viz {
    margin: 0 auto;
    border: 1px solid #000;
    height: 650px;
    position: relative;
    /*display: flex;*/
    /*justify-content: center;*/
    /*align-items: center;*/
  }

  /* Legend Position Style */
  .legend {
    position:absolute;
    left:20px;
    top:30px;
  }

  .axis text {
    font: 10px sans-serif;
  }

  .axis line, .axis path {
    fill: none;
    stroke: #000;
    shape-rendering: crispEdges;
  }

</style>

<!-- Primary Page Layout
–––––––––––––––––––––––––––––––––––––––––––––––––– -->
  </head>
  <body>

    <h2>State + Social Map</h2>
    <div id="viz"></div>


<!-- SCRIPTS
–––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script src="//d3js.org/d3.v4.min.js"></script>

  <script>
    
    /*
      D3 VISULAIZATION - CATEGORY STATS BULLET CHART

      The D3 code below was created with the help of the fantastic tutorial by Scott Murray, found here: http://alignedleft.com/tutorials/d3/

      Take note, I've used the "react-faux-dom" module by Oliver Caldwell within this component. It's necessary for D3 to work it's magic within React.
      You can find the module's github repo here: https://github.com/Olical/react-faux-dom.

      Also, for info on integrating D3 with ReactJS check out Oliver's blogpost here: http://oli.me.uk/2015/09/09/d3-within-react-the-right-way/
    */


    (function() { // self executing function here


      var stateCode = {
        "AL":"Alabama",
        "AK":"Alaska",
        "AR":"Arkansas",
        "AZ":"Arizona",
        "CA":"California",
        "CO":"Colorado",
        "CT":"Connecticut",
        "DE":"Delaware",
        "DC":"District of Columbia",
        "FL":"Florida",
        "GA":"Georgia",
        "HI":"Hawaii",
        "IA":"Iowa",
        "ID":"Idaho",
        "IL":"Illinois",
        "IN":"Indiana",
        "KS":"Kansas",
        "KY":"Kentucky",
        "LA":"Louisiana",
        "ME":"Maine",
        "MD":"Maryland",
        "MA":"Massachusetts",
        "MI":"Michigan",
        "MN":"Minnesota",
        "MO":"Missouri",
        "MS":"Mississippi",
        "MT":"Montana",
        "NC":"North Carolina",
        "ND":"North Dakota",
        "NE":"Nebraska",
        "NH":"New Hampshire",
        "NJ":"New Jersey",
        "NM":"New Mexico",
        "NV":"Nevada",
        "NY":"New York",
        "OH":"Ohio",
        "OK":"Oklahoma",
        "OR":"Oregon",
        "PA":"Pennsylvania",
        "RI":"Rhode Island",
        "SC":"South Carolina",
        "SD":"South Dakota",
        "TN":"Tennessee",
        "TX":"Texas",
        "UT":"Utah",
        "VA":"Virginia",
        "VT":"Vermont",
        "WA":"Washington",
        "WI":"Wisconsin",
        "WV":"West Virginia",
        "WY":"Wyoming"
      }

      d3.json("state_social_map.json", function(error, json) {
        if (error) throw error;

        //Width and height of map
        var width = 960;
        var height = 500;

        // var lowColor = '#f9f9f9'
        // var highColor = '#bc2a66'

        // var lowColor = '#DDFFCC'
        var lowColor = '#f9f9f9'
        var highColor = '#30D8F0'

        // var highColor = '#3A5F6F'
        // var highColor = '#243757'

        // D3 Projection
        var projection = d3.geoAlbersUsa()
          .translate([width / 2, height / 2]) // translate to center of screen
          .scale([1000]); // scale things down so see entire US

        // Define path generator
        var path = d3.geoPath() // path generator that will convert GeoJSON to SVG paths
          .projection(projection); // tell path generator to use albersUsa projection

        //Create SVG element and append map to the SVG
        var svg = d3.select("#viz")
          .append("svg")
          .attr("width", width)
          .attr("height", height);


        var fbArr = [], ytArr = [];
        for (var d = 0; d < json.data.length; d++) {
          fbArr.push(parseFloat(json.data[d].facebook_user_rank_max))
          // ytArr.push(parseFloat(json.data[d].youtube_user_rank_max))
        }
        var fbMin = 1
        var fbMax = d3.max(fbArr)
        var fbRamp = d3.scaleLinear().domain([fbMin,fbMax]).range([lowColor,highColor])

        // var ytMin = d3.min(ytArr)
        // var ytMax = d3.max(ytArr)
        // var ytRamp = d3.scaleLinear().domain([ytMin,ytMax]).range([lowColor,highColor])


        console.log({ fbArr, fbMin, fbMax, fbRamp })
        // console.log({ ytArr, ytMin, ytMax, ytRamp })


        // Load GeoJSON data and merge with states data
        d3.json("us-states.json", function(stateJson) {

          // Loop through each state data value in the .csv file
          for (var i = 0; i < json.data.length; i++) {

            // Grab State Name
            var dataState = stateCode[json.data[i].state];

            // Grab data value 
            var dataValue = Math.round(json.data[i].facebook_user_rank_avg);
            // var dataValue = json.data[i].youtube_user_rank_avg;

            // Find the corresponding state inside the GeoJSON
            for (var j = 0; j < stateJson.features.length; j++) {
              var jsonState = stateJson.features[j].properties.name;

              if (dataState == jsonState) {

                // Copy the data value into the JSON
                stateJson.features[j].properties.value = dataValue;

                // Stop looking through the JSON
                break;
              }
            }
          }

          // Bind the data to the SVG and create one path per GeoJSON feature
          svg.selectAll("path")
            .data(stateJson.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("stroke", "#fff")
            .style("stroke-width", "1")
            .style("fill", function(d) { return fbRamp(d.properties.value) });


          // add a legend
          var w = 140, h = 300;

          var key = d3.select("#viz")
            .append("svg")
            .attr("width", w)
            .attr("height", h)
            .attr("class", "legend");

          var legend = key.append("defs")
            .append("svg:linearGradient")
            .attr("id", "gradient")
            .attr("x1", "100%")
            .attr("y1", "0%")
            .attr("x2", "100%")
            .attr("y2", "100%")
            .attr("spreadMethod", "pad");

          legend.append("stop")
            .attr("offset", "0%")
            .attr("stop-color", highColor)
            .attr("stop-opacity", 1);
            
          legend.append("stop")
            .attr("offset", "100%")
            .attr("stop-color", lowColor)
            .attr("stop-opacity", 1);

          key.append("rect")
            .attr("width", w - 100)
            .attr("height", h)
            .style("fill", "url(#gradient)")
            .attr("transform", "translate(0,10)");

          var y = d3.scaleLinear()
            .range([h, 0])
            .domain([fbMin, fbMax]);

          var yAxis = d3.axisRight(y);

          key.append("g")
            .attr("class", "y axis")
            .attr("transform", "translate(41,10)")
            .call(yAxis)


        });

      })

    })();

  </script>

<!-- End Document
–––––––––––––––––––––––––––––––––––––––––––––––––– -->
  </body>
</html>